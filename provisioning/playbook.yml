---
- hosts: vagrant
  user: vagrant

  vars:
    gem_path: ~/.rvm/gems/$ruby/bin
    ruby: ruby-head
    user: vagrant

  tasks:
    - name: update sudoers
      action: copy src=templates/sudoers dest=/etc/sudoers
      sudo: True

    - name: update apt
      action: command /usr/bin/apt-get update
      sudo: True

    - name: update cache 
      apt: update_cache=yes
      sudo: True

    - name: install essential packages
      apt: pkg=$item state=installed
      sudo: True
      with_items:
        - build-essential
        - curl
        - git
        - python-dev
        - python-setuptools
        - python-software-properties

    - include: tasks/rvm.yml
    
    - name: install bundler
      shell: $gem_path/gem install bundler
      
    # Install postgres
    - include: tasks/postgres.yml
    # Install Redis
    - include: tasks/redis.yml
    # Install node.js for a JS Runtime
    - include: tasks/node.yml
    
    # Install general ruby/rails deps
    - name: install some dependencies for some gems
      apt: name={{item}} state=latest update_cache=yes
      with_items:
        - imagemagick
        - libxml2-dev
        - libxslt1-dev
        - sqlite3
        - libsqlite3-dev
        - libqtwebkit-dev
        - xvfb

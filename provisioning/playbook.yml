---
- hosts: vagrant
  user: vagrant
  gather_facts: no

  vars:
    gem: /home/vagrant/.rvm/rubies/ruby-head/bin/gem
    ruby: ruby-head

  tasks:
    # Basic server config and setup
    - include: tasks/configure.yml
    
    # Install components
    - include: tasks/rvm.yml
    - include: tasks/postgres.yml
    - include: tasks/redis.yml
    - include: tasks/node.yml
    
  handlers:
    - name: restart postgresql
      action: service name=postgresql state=restarted
      sudo: True

    - name: restart nginx
      action: service name=nginx pattern=/etc/init.d/nginx state=restarted enabled=yes
        
- hosts: vagrant
  sudo: True
  user: vagrant
  sudo_user: postgres

  tasks:
    - name: create a vagrant database user
      action: postgresql_user user=vagrant password=password role_attr_flags=CREATEDB

 
